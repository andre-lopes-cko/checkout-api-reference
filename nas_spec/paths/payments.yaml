/payments:
  post:
    security:
      - OAuth:
          - gateway
          - gateway:payment
      - ApiSecretKey: [ ]
    tags:
      - Payments
    summary: Request a payment or payout
    operationId: requestAPaymentOrPayout
    description: |
      Send a payment or payout.<br><br><b>Note</b>: successful payout requests will always return a 202 response.
    parameters:
      - $ref: '#/components/parameters/ckoIdempotencyKey'
    requestBody:
      content:
        application/json:
          schema:
            oneOf:
              - $ref: '#/components/schemas/PaymentRequest'
              - $ref: '#/components/schemas/PTC_PayoutRequest'
          examples:
            Payment:
              value:
                source:
                  type: token
                  token: tok_4gzeau5o2uqubbk6fufs3m7p54
                amount: 6540
                currency: USD
                payment_type: Recurring
                reference: 'ORD-5023-4E89'
                description: 'Set of 3 masks'
                capture: true
                capture_on: '2019-09-10T10:11:12Z'
                customer:
                  id: 'cus_udst2tfldj6upmye2reztkmm4i'
                  email: 'brucewayne@gmail.com'
                  name: 'Bruce Wayne'
                billing_descriptor:
                  name: SUPERHEROES.COM
                  city: GOTHAM
                shipping:
                  address:
                    address_line1: Checkout.com
                    address_line2: 90 Tottenham Court Road
                    city: London
                    state: London
                    zip: W1T 4TJ
                    country: GB
                  phone:
                    country_code: '+1'
                    number: 415 555 2671
                3ds:
                  enabled: true
                  attempt_n3d: true
                  eci: '05'
                  cryptogram: AgAAAAAAAIR8CQrXcIhbQAAAAAA=
                  xid: MDAwMDAwMDAwMDAwMDAwMzIyNzY=
                  version: '2.0.1'
                previous_payment_id: 'pay_fun26akvvjjerahhctaq2uzhu4'
                risk:
                  enabled: false
                success_url: 'http://example.com/payments/success'
                failure_url: 'http://example.com/payments/fail'
                payment_ip: '90.197.169.245'
                recipient:
                  dob: '1985-05-15'
                  account_number: '5555554444'
                  zip: W1T
                  last_name: Jones
                metadata:
                  coupon_code: 'NY2018'
                  partner_id: 123989
            PTC:
              value:
                source:
                  type: currency_account
                  id: ca_00000000000000000000000000
                  amount: 20000
                destination:
                  type: token|id|card
                  token: tok_00000000000000000000000000
                  id: PAYMENT_INSTRUMENT_ID
                  number: '4200000000000000'
                  expiry_month: 2
                  expiry_year: 2024
                  account_holder:
                    type: individual|corporate|government
                    first_name: Clark
                    last_name: Kent
                    middle_name: Joseph
                    company_name: Daily Planet
                    date_of_birth: '1938-04-18'
                    country_of_birth: US
                    billing_address:
                      address_line_1: Apt. 3D
                      address_line_2: 344 Clinton St
                      city: Metropolis
                      state: NY
                      zip: '33866'
                      country: US
                    phone:
                      country_code: '1'
                      number: 202-555-0000
                    identification:
                      type: passport|driving_license|national_id|company_registration|tax_id
                      number: D55422213
                      issuing_country: US
                      date_of_expiry: '2028-11-20'
                    email: clark.kent@dailyplanet.net
                amount: 30000
                currency: USD
                reference: EXAMPLE-MERCHANT-REFERENCE
                billing_descriptor:
                  reference: DESCRIPTION-ON-ACCOUNT-STATEMENT
                sender:
                  type: individual|corporate|government
                  first_name: Bruce
                  last_name: Wayne
                  middle_name: Thomas
                  company_name: Wayne Enterprises
                  address:
                    address_line_1: Wayne Manor
                    address_line_2: 1007 Mountain Drive
                    city: Gotham
                    state: NJ
                    zip: '77701'
                    country: US
                  reference: bruce@waynecorp.com
                  reference_type: rtn_and_ban|iban|card_account|email|phone_number|ban_and_bic|wallet_id|social_network_id|other
                  date_of_birth: '1939-05-27'
                  country_of_birth: US
                  nationality: US
                  source_of_funds: credit|debit|prepaid|deposit_account|mobile_money_account_cash
                  identification:
                    type: passport|driving_license|national_id|company_registration|tax_id
                    number: '55511199'
                    issuing_country: US
                    date_of_expiry: '2031-01-13'
                instruction:
                  purpose: pension|...
                  funds_transfer_type: AA
                  mvv: 4441223
                  quote_id: qte_00000000000000000000000000
                  skip_expiry: false
                processing_channel_id: pc_00000000000000000000000000

    responses:
      '202':
        description: Payment asynchronous or further action required
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/PaymentAcceptedResponse'
                - $ref: '#/components/schemas/PTC_PayoutRequestAcceptedResponse'
        headers:
          Cko-Request-Id:
            $ref: '#/components/headers/Cko-Request-Id'
          Cko-Version:
            $ref: '#/components/headers/Cko-Version'
      '401':
        description: Unauthorized
      '429':
        description: Too many requests or duplicate request detected
        content:
          application/json:
            schema:
              type: object
              properties:
                request_id:
                  type: string
                  example: 0HL80RJLS76I7
                error_type:
                  type: string
                  example: request_invalid
                error_codes:
                  type: array
                  items:
                    type: string
                    example: duplicate_request
      '422':
        description: Invalid data was sent
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidationError'
      '502':
        description: Bad gateway
