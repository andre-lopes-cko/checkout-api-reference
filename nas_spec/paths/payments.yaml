/payments:
  post:
    security:
      - OAuth:
          - gateway
          - gateway:payment
      - ApiSecretKey: [ ]
    tags:
      - Payments
    summary: Request a payment or payout
    operationId: requestAPaymentOrPayout
    description: |
      Send a payment or payout.<br><br><b>Note</b>: successful payout requests will always return a 202 response.
    parameters:
      - $ref: '#/components/parameters/ckoIdempotencyKey'
    requestBody:
      content:
        application/json:
          schema:
            oneOf:
              - $ref: '#/components/schemas/PaymentRequest'
              - $ref: '#/components/schemas/PTC_PayoutRequest'
          examples:
            Payment:
              value:
                source:
                  type: token
                  token: tok_4gzeau5o2uqubbk6fufs3m7p54
                amount: 6540
                currency: USD
                payment_type: Recurring
                reference: 'ORD-5023-4E89'
                description: 'Set of 3 masks'
                capture: true
                capture_on: '2019-09-10T10:11:12Z'
                customer:
                  id: 'cus_udst2tfldj6upmye2reztkmm4i'
                  email: 'brucewayne@gmail.com'
                  name: 'Bruce Wayne'
                billing_descriptor:
                  name: SUPERHEROES.COM
                  city: GOTHAM
                shipping:
                  address:
                    address_line1: Checkout.com
                    address_line2: 90 Tottenham Court Road
                    city: London
                    state: London
                    zip: W1T 4TJ
                    country: GB
                  phone:
                    country_code: '+1'
                    number: 415 555 2671
                3ds:
                  enabled: true
                  attempt_n3d: true
                  eci: '05'
                  cryptogram: AgAAAAAAAIR8CQrXcIhbQAAAAAA=
                  xid: MDAwMDAwMDAwMDAwMDAwMzIyNzY=
                  version: '2.0.1'
                previous_payment_id: 'pay_fun26akvvjjerahhctaq2uzhu4'
                risk:
                  enabled: false
                success_url: 'http://example.com/payments/success'
                failure_url: 'http://example.com/payments/fail'
                payment_ip: '90.197.169.245'
                recipient:
                  dob: '1985-05-15'
                  account_number: '5555554444'
                  zip: W1T
                  last_name: Jones
                metadata:
                  coupon_code: 'NY2018'
                  partner_id: 123989
            PTC:
              value:
                payment_id: "pay_l45ga4nr37cevghk5jkvki34my"
                source:
                  id: "ca_q7ypx45iejtu3hustadeuipegy"
                  amount: 100
                destination:
                  amount": 100,
                  currency: "GBP"
                  card_number: "4444333322221111"
                  card_expiry_year: 2031
                  card_expiry_month: 12
                  type: "individual"
                  first_name: "Frodo"
                  last_name: "Baggins"
                  middle_name: ""
                  company_name": ""
                  dob: "1902-02-12"
                  country_of_birth: "NZ"
                  billing_address_line_1: "1 Bag End"
                  billing_address_line_2: "The Shire"
                  billing_address_city: "Hobbiton"
                  billing_address_state: ""
                  billing_address_country: "NZ"
                  billing_address_zip_code: "1R LOTR"
                  phone_country_code: "64"
                  phone_number: "07777 123456"
                  identification_type: "passport"
                  identification_number: "NZ1234567890"
                  identification_country_of_issue: "NZ"
                  identification_expiry_date: "2025-12-01"
                  email: "frodo.baggins@elf.net"
                  reference: "merchant_ref_123"
                  billing_descriptor: "The One Ring"
                  card_metadata:
                    fingerprint: "7f2h7238f8798"
                    scheme": "visa"
                    last_4": "4552"
                    bin": "46667"
                    card_type": "debit"
                    card_category": "consumer"
                    issuer": "CitiBank"
                    issuer_country": "UK"
                    product_id": "1"
                    product_type": "a_product_type"
                    billing_currency": "GBP"
                    card_sub_type": "reloadable"
                    lac_combo": "debit + prepaid"
                    non_mt_oct_domestic": false
                    ff_non_mt_oct_domestic: false
                    non_mt_oct_cross_border: false
                    ff_non_mt_oct_cross_border: false
                    mt_oct_domestic: false
                    ff_mt_oct_domestic: false
                    mt_oct_cross_border: false
                    ff_mt_oct_cross_border: false
                    gambling_oct_domestic: false
                    ff_gambling_oct_domestic: false
                    gambling_oct_cross_border: false
                    ff_gambling_oct_cross_border: false
                    oct_eligible: "Y"
                    ff_eligible: "Y"
                    account_range_min: "45660"
                    account_range_max: "45699"
                    country_code: 1
                    region: "a_region"
                sender:
                  type: "individual"
                  first_name: "Jake"
                  last_name: "Peralta"
                  middle_name: ""
                  company_name: ""
                  address_line_1: "99th Precinct"
                  address_line_2: "Brooklyn"
                  city: "New York"
                  state: "NY"
                  zip: "10099"
                  country: "US"
                  dob: "1985-12-12"
                  country_of_birth: "US"
                  reference: "sender_ref_123"
                  reference_type: "social_network_id"
                  source_of_funds: "credit"
                  identification_type: "driving_license"
                  identification_number: "US1234599"
                  identification_country_of_issue: "US"
                  identification_expiry_date: "2029-12-01"
                  identification_nationality: "US"
                instruction:
                  action_id: "act_bc7z4hrgswnuxbjjov6z5mk4za"
                  transaction_id: "109745d3-259b-4612-a87a-916c1b2c4214"
                  processing_channel_id: "pc_ybhb2bmz5cvexgqrqi2dzgarju"
                  fx_quote_id: "qte_76kewxu3ayfezhf2xxkjacieda"
                  fund_transfer_type: "C07"
                  mvv: "1234"
                  purpose: "travel_and_tourism"
                client:
                  entity_id: "ent_l4ez4j32ouaefkl77yoade65va"
    responses:
      '202':
        description: Payment asynchronous or further action required
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/PaymentAcceptedResponse'
                - $ref: '#/components/schemas/PTC_PayoutRequestAcceptedResponse'
        headers:
          Cko-Request-Id:
            $ref: '#/components/headers/Cko-Request-Id'
          Cko-Version:
            $ref: '#/components/headers/Cko-Version'
      '401':
        description: Unauthorized
      '429':
        description: Too many requests or duplicate request detected
        content:
          application/json:
            schema:
              type: object
              properties:
                request_id:
                  type: string
                  example: 0HL80RJLS76I7
                error_type:
                  type: string
                  example: request_invalid
                error_codes:
                  type: array
                  items:
                    type: string
                    example: duplicate_request
      '422':
        description: Invalid data was sent
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidationError'
      '502':
        description: Bad gateway
